<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title id="pageTitle">RoboKavi - Marathi Poem Plotter</title>
  <style>
    #mainUI { display: none; }
    #startBtn { font-size: 24px; padding: 20px; }
    .hidden { display: none; }
  </style>
</head>
<body onload="setup()">
  <!-- ЁЯЪА Start Screen -->
  <div id="startScreen">
    <h1>RoboKavi</h1>
    <button id="startBtn" onclick="startApp()">тЦ╢я╕П Start</button>
  </div>

  <!-- ЁЯМР Main App UI -->
  <div id="mainUI">
    <h1 id="title">RoboKavi - Marathi Poem Plotter</h1>

    <label>
      ЁЯМР <input type="checkbox" id="langSwitch" onchange="toggleLang()"> English / рдорд░рд╛рдареА
    </label><br><br>

    <label>Choose Input Mode:</label><br>
    <input type="radio" name="inputMode" id="voiceMode" onchange="selectInputMode()"> ЁЯОЩя╕П Voice
    <input type="radio" name="inputMode" id="typeMode" onchange="selectInputMode()" checked> тЬНя╕П Type<br><br>

    <label id="nameLabel">Enter Name:</label><br>
    <input type="text" id="name"><br>

    <label id="subjectLabel">Enter Subject:</label><br>
    <input type="text" id="subject"><br><br>

    <button onclick="generatePoem()" id="submitBtn">Generate Poem</button>

    <p id="status" style="font-weight:bold; font-size: 1.2em; margin-top: 1em;"></p>
    <pre id="poemOutput" style="white-space: pre-wrap; font-size: 1.1em;"></pre>
  </div>

  <script>
    let language = "en";

    function setup() {
      toggleLang();  // Set default lang labels
    }

    function startApp() {
      speak("рдореА рд░реЛрдмреЛрдХрд╡реА рдЖрд╣реЗ. рддреБрдордЪрдВ рд╕реНрд╡рд╛рдЧрдд рдЖрд╣реЗ");
      document.getElementById("startScreen").style.display = "none";
      document.getElementById("mainUI").style.display = "block";
    }

    function toggleLang() {
      language = document.getElementById("langSwitch").checked ? "mr" : "en";
      document.getElementById("pageTitle").innerText =
      document.getElementById("title").innerText =
        language === "mr" ? "рд░реЛрдмреЛрдХрд╡реА - рдорд░рд╛рдареА рдХрд╡рд┐рддрд╛ рдкреНрд▓реЙрдЯрд░" : "RoboKavi - Marathi Poem Plotter";
      document.getElementById("nameLabel").innerText =
        language === "mr" ? "рддреБрдордЪрдВ рдирд╛рд╡:" : "Enter Name:";
      document.getElementById("subjectLabel").innerText =
        language === "mr" ? "рддреБрдордЪрд╛ рдЖрд╡рдбрддрд╛ рд╡рд┐рд╖рдп:" : "Enter Subject:";
      document.getElementById("submitBtn").innerText =
        language === "mr" ? "рдХрд╡рд┐рддрд╛ рддрдпрд╛рд░ рдХрд░рд╛" : "Generate Poem";
    }

    function selectInputMode() {
      if (document.getElementById("voiceMode").checked) {
        handleVoiceInput();
      }
    }

    function speak(text) {
      const synth = window.speechSynthesis;
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = language === "mr" ? "mr-IN" : "en-US";
      synth.speak(utter);
    }

    function listen(targetId, promptText, callback = null) {
      speak(promptText);
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = language === "mr" ? "mr-IN" : "en-US";
      recognition.onresult = (event) => {
        document.getElementById(targetId).value = event.results[0][0].transcript;
        if (callback) callback();
      };
      recognition.start();
    }

    function handleVoiceInput() {
      const namePrompt = language === "mr" ? "рддреБрдордЪрдВ рдирд╛рд╡ рд╕рд╛рдВрдЧрд╛" : "Please tell your name";
      const subjectPrompt = language === "mr" ? "рддреБрдордЪрд╛ рдЖрд╡рдбрддрд╛ рд╡рд┐рд╖рдп рд╕рд╛рдВрдЧрд╛" : "Please tell your favorite subject";

      listen("name", namePrompt, () => {
        setTimeout(() => listen("subject", subjectPrompt), 4000);
      });
    }

    async function generatePoem() {
      const name = document.getElementById("name").value;
      const subject = document.getElementById("subject").value;

      const status = document.getElementById("status");
      const output = document.getElementById("poemOutput");

      if (!name || !subject) {
        status.innerText = language === "mr" ? "тЭЧ рдХреГрдкрдпрд╛ рдирд╛рд╡ рдЖрдгрд┐ рд╡рд┐рд╖рдп рджреНрдпрд╛." : "тЭЧ Please provide name and subject.";
        return;
      }

      status.innerText = language === "mr" ? "ЁЯза рдХрд╡рд┐рддрд╛ рддрдпрд╛рд░ рд╣реЛрддреЗ рдЖрд╣реЗ..." : "ЁЯза Generating poem...";
      output.innerText = "";

      try {
        const response = await fetch("/generate-poem", {
          method: "POST",
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, subject, language })
        });

        const data = await response.json();
        if (!response.ok || data.error) {
          status.innerText = "тЭМ " + (data.error || "Something went wrong.");
          return;
        }

        output.innerText = data.poem || "No poem generated.";
        status.innerText = language === "mr"
          ? "тЬНя╕П рд░реЛрдмреЛрдХрд╡реА рдХрд╡рд┐рддрд╛ рд▓рд┐рд╣реАрдд рдЖрд╣реЗ..."
          : "тЬНя╕П RoboKavi is writing your poem...";

        setTimeout(() => { status.innerText = ""; }, 15000);

      } catch (error) {
        console.error(error);
        status.innerText = "тЭМ Error connecting to server.";
      }
    }
  </script>
</body>
</html>
